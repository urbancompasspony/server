#!/bin/bash

export pty=True
export NEEDRESTART_MODE=a
export DEBIAN_FRONTEND=noninteractive

# Hashs
hash2="576200e78f0ab25b437dc7372ae920d9"
hash3="9ae7c2a8e120dssssa4915cba5a15e17"

# PASSWORD
function init {
password=$(dialog --backtitle "$bktitle" --title "Acesso ao USM" --insecure --passwordbox "Digite a senha!" 0 0 2>&1 > /dev/tty)
hash1=$(echo "$password" | md5sum | awk '{print $1}')
  [ -z "$password" ] && {
    clear
    echo "É necessário digitar uma senha para continuar. Tente novamente!"
  } || {
    [ "$hash1" = "$hash2" ] || [ "$hash1" = "$hash3" ] && {
      start
    } || {
      echo "É necessário digitar a senha correta. Saindo."
      }
  }
}

function start {
var0=$(dialog --title 'System Manager' --backtitle "Sistema Automatizado de Orquestração de Sistemas!" --menu " " 0 0 0 \
A 'Linite' \
B 'Server Manager' \
C 'Orchestra' \
D 'Docker' \
E 'Domain [Local]' \
F 'Domain [Docker]' \
G 'Virtual Machines' \
H 'G.U.I. [Local]' \
I 'Tools' \
J 'Bashrc' \
K 'DWAgent [x86]' \
L 'DWAgent [ARM]' \
M 'Beep!' \
X 'Sair' 2>&1 > /dev/tty )

case "$var0" in
A) curl -sSL https://raw.githubusercontent.com/urbancompasspony/linite/main/linite | sudo bash ; start ;;
B) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/1ni1t | sudo bash ; start ;;
C) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/orchestration | bash ; start ;;
D) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/docker | bash ; start ;;
E) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/domain | bash ; start ;;
F) echodomain ;;
G) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/vm_machine | sudo bash ; start ;;
H) startx ; start ;;
I) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/tools | sudo bash ; start ;;
J) curl -sSL https://raw.githubusercontent.com/urbancompasspony/bashrc/main/install.sh | bash ; start ;;
K) wget https://www.dwservice.net/download/dwagent_x86.sh -O /home/administrador/dwagent_x86.sh ; start ;;
L) wget https://www.dwservice.net/download/dwagent_generic.sh -O /home/administrador/dwagent_generic.sh ; start ;;
M) wget https://raw.githubusercontent.com/urbancompasspony/beep/main/beep -O /home/administrador/.beep.sh ; start ;;
X) echo "Saindo..." ;;
esac
}

function echodomain {
  echo " "
  echo "# # #"
  echo " "
  echo "Digite 'domain' para acessar o menu do Active Directory em Docker!"
  echo " "
  echo "# # #"
  echo " "
}

sudo apt install dialog curl -y
[ $? -ne 0 ] && exit

[ "$EUID" -ne 0 ] || {
  echo "Não execute esse script como Root! Saindo..."
  exit
  }

#init
start
