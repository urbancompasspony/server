#!/bin/bash

export pty=True
export NEEDRESTART_MODE=a
export DEBIAN_FRONTEND=noninteractive

# Hashs
hash1="fbc5c0070b7d8b939700ad689f690784"
hash2="576200e78f0ab25b437dc7372ae920d9"

# PASSWORD
function orchestrapass {
password=$(dialog --backtitle "$bktitle" --title "Acesso ao USM" --insecure --passwordbox "Digite a senha!" 0 0 2>&1 > /dev/tty)
hash0=$(echo "$password" | md5sum | awk '{print $1}')
  [ -z "$password" ] && {
    clear
    echo "É necessário digitar uma senha para continuar. Tente novamente!"
  } || {
    [ "$hash0" = "$hash1" ] || [ "$hash0" = "$hash2" ] && {
      curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/orchestration | bash
    } || {
      echo "É necessário digitar a senha correta! Voltando..."
      }
  }
}

# START!

function start {
var0=$(dialog --title 'System Manager' --backtitle "Sistema Automatizado de Orquestração de Sistemas!" --menu " " 0 0 0 \
A 'Linite' \
B 'Server Manager' \
C 'Orchestra' \
D 'Domain [Local]' \
E 'Domain [Docker]' \
F 'G.U.I. [Local]' \
G 'Tools' \
H 'Bashrc' \
I 'DWAgent [x86]' \
J 'DWAgent [ARM]' \
K 'Beep!' \
X 'Sair' 2>&1 > /dev/tty )

case "$var0" in
A) curl -sSL https://raw.githubusercontent.com/urbancompasspony/linite/main/linite | sudo bash ; start ;;
B) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/1ni1t | sudo bash ; start ;;
C) orchestrapass ; start ;;
D) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/domain | bash ; start ;;
E) echodomain ;;
F) echogui ;;
G) curl -sSL https://raw.githubusercontent.com/urbancompasspony/server/main/tools | sudo bash ; start ;;
H) curl -sSL https://raw.githubusercontent.com/urbancompasspony/bashrc/main/install.sh | bash ; start ;;
I) wget https://www.dwservice.net/download/dwagent_x86.sh -O /home/$USER/dwagent_x86.sh ; start ;;
J) wget https://www.dwservice.net/download/dwagent_generic.sh -O /home/$USER/dwagent_generic.sh ; start ;;
K) sudo env -u SUDO_GID -u SUDO_COMMAND -u SUDO_USER -u SUDO_UID beep ; start ;;
X) echo "Saindo..." ;;
esac
}

function echodomain {
  echo " "
  echo "# # #"
  echo " "
  echo "Digite 'domain' para acessar o menu do Active Directory em Docker!"
  echo " "
  echo "# # #"
  echo " "
}

function echogui {
  echo " "
  echo "# # #"
  echo " "
  echo "Digite 'startx' para acessar a Interface de Usuário!"
  echo " "
  echo "# # #"
  echo " "
}

sudo apt install dialog curl -y
[ $? -ne 0 ] && exit

[ "$EUID" -ne 0 ] || {
  echo "Não execute esse script como Root! Saindo..."
  exit
  }

start
