#!/bin/bash

function tools {
  if ! var0=$(dialog --title "" --backtitle "" --menu " " 0 0 0 \
  1 'Set MACVLAN' \
  2 'Remove MACVLAN' \
  3 'PiHole Maintenance' \
  4 'PiHole Install Error' \
  5 'Reset Syncthing Password' \
  6 'NC: filelocks' \
  7 'NC: add-missing-indices' \
  8 'NC: check-core & mimetype' \
  9 'NC: Disable LDAP' \
  10 'NC: Upgrade Manually CLI' \
  11 'NC: Scan App Data' \
  12 'NC: Scan User Data' \
  13 'Remove All Useless Images' \
  X '<' 2>&1 > /dev/tty ); then
    return
  fi
  
  case "$var0" in
  1) clear ; macvland ;;
  2) clear ; rmmacvland ;;
  3) clear ; piholemnt ;;
  4) clear ; piholeinst ;;
  5) clear ; syncpass0 ;;
  6) clear ; filelocks ;;
  7) clear ; missingindices ;;
  8) clear ; checkcore ;;
  9) clear ; disableldap ;;
  10) clear ; upgradenc ;;
  11) clear ; scanapp0 ;;
  12) clear ; scanuser0 ;;
  13) clear ; docker image prune -af ; sleep 2 ;;
  X) return ;;
  esac
}

function scanapp0 {
  VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Nextcloud" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)
  clear; echo "Checking core integrity..."
  docker exec -u 33 "$var1" ./occ files:scan-app-data
  sleep 3
}

function scanuser0 {
  VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Nextcloud" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)
  clear; echo "Checking core integrity..."
  docker exec -u 33 "$var1" ./occ files:scan --all
  sleep 3
}

function syncpass0 {
  VALUE1="syncthing"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Syncthing" 8 35 0 \
  "NomeCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)
  clear
  docker exec -it "$var1" syncthing generate --gui-password=admin --gui-user=admin
  echo ""; echo "Usuario e senha da WebGUI foram modificados para admin/admin!"
}

function upgradenc {
  VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Nextcloud" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)

  clear
  echo "Upgrading..."
  docker exec -u 33 "$var1" ./occ upgrade
  sleep 3
}

function disableldap {
  VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Disable LDAP" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)

  clear
  echo "Disabling LDAP Backend!"
  docker exec -u 33 "$var1" ./occ ldap:set-config "s01" "ldapConfigurationActive" "0"
  sleep 2
  docker restart "$var1"
  sleep 3
}

function checkcore {
VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Nextcloud" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)
  clear; echo "Checking core integrity..."
  docker exec -u 33 "$var1" ./occ integrity:check-core
  docker exec -u 33 "$var1" ./occ maintenance:mimetype:update-js
  docker exec -u 33 "$var1" ./occ integrity:check-core
  docker exec -u 33 "$var1" ./occ maintenance:mimetype:update-js
  sleep 3
}

function missingindices {
  VALUE1="nextcloud"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "Nextcloud" 9 35 0 \
  "NextCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)

  clear
  echo "Adding missing indices..."
  docker exec -u 33 "$var1" ./occ db:add-missing-indices
  echo "ok"; sleep 3

  clear
  echo "Fixing mimetypes..."
  docker exec -u 33 "$var1" ./occ maintenance:repair --include-expensive
  echo "ok"; sleep 3

  sleep 3
}

function piholemnt {
  VALUE1="pihole"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "PiHole" 8 35 0 \
  "NomeCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  clear
  var1=$(echo "$VALUE0" | sed -n 1p)
  docker exec "$var1" bash -c "pihole -g -r recover"
  docker exec "$var1" bash -c "rm /etc/pihole/pihole-FTL.db"
  docker restart "$var1"
}

function piholeinst {
  VALUE1="pihole"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "PiHole" 8 35 0 \
  "NomeCont:" 1 1 "$VALUE1" 1 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  clear
  var1=$(echo "$VALUE0" | sed -n 1p)
  docker exec "$var1" bash -c "rm /etc/pihole/gravity.db"
  docker exec "$var1" bash -c "pihole -g"
  docker restart "$var1"
}

function filelocks {
  VALUE1="nextcloud-mysql"

  if ! VALUE0=$(dialog --ok-label "Ok" --title "Manutencao" --form "MySQL - NextCloud" 9 35 0 \
  "mSQLcont:" 1 1 "$VALUE1" 1 11 30 0 \
  "Password:" 2 1 "$VALUE2" 2 11 30 0 \
  3>&1 1>&2 2>&3 3>&- > /dev/tty); then
    return
  fi

  var1=$(echo "$VALUE0" | sed -n 1p)
  var2=$(echo "$VALUE0" | sed -n 2p)

  clear
  echo "File Locks atualmente no Banco de Dados:"
  docker exec "$var1" mysql --user=root -D nextcloud -e 'SELECT * FROM oc_file_locks;'
  sleep 5
  docker exec "$var1" mysql --user=root --password="$var2" -D nextcloud -e 'delete from oc_file_locks where 1'
  sleep 1
  clear
  echo "Conferencia de limpeza de File Locks:"
  docker exec "$var1" mysql --user=root -D nextcloud -e 'SELECT * FROM oc_file_locks;'
  echo "Se nada aparecer aqui, foi limpo com sucesso!"
  sleep 3
}

function macvland {
  var1="0"; var2="0"; var3="0"; var4="0"

  #VALUE1="${meugateway%.*}.0"
  VALUE2=$(ip route get 1.1.1.1 | grep -oP 'via \K\S+')
  VALUE3=$(ip route get 1.1.1.1 | grep -oP 'dev \K\S+')
  VALUE4="macvlan"

  VALUE0=$(dialog --help-button --help-label "Dica" --ok-label "Criar" --title "Criar novo MACVLAN" --form "MACVLAN for Containers" 11 40 0 \
"Subnet  :" 1 1 "$VALUE1" 1 11 30 0 \
"Gateway :" 2 1 "$VALUE2" 2 11 30 0 \
"Parent  :" 3 1 "$VALUE3" 3 11 30 0 \
"Name    :" 4 1 "$VALUE4" 4 11 30 0 \
3>&1 1>&2 2>&3 3>&- > /dev/tty)

  case $? in
    0) echo "." > /dev/null ;;
    1) exit ;;
    2) dialognet ; macvland ;;
  esac

echo "$VALUE0"

  var1=$(echo "$VALUE0" | sed -n 1p)
  var2=$(echo "$VALUE0" | sed -n 2p)
  var3=$(echo "$VALUE0" | sed -n 3p)
  var4=$(echo "$VALUE0" | sed -n 4p)

  if [ "$var1" = "0" ] || [ "$var2" = "0" ] || [ "$var3" = "0" ] || [ "$var4" = "0" ]; then
    dialog --title "ERRO" --msgbox "O(s) campo(s) exigidos nao pode(m) ficar em branco. \nPreencha-o(s) adequadamente!" 7 40
    macvland
  else
    macvlanr=$(docker inspect "$var4" 1>/dev/null 2>/dev/null && echo yes || echo no)
    if [ "$macvlanr" = "no" ];then
      # Cria a rede docker
      docker network create -d macvlan --subnet="$var1"/24 --gateway="$var2" -o parent="$var3" "$var4"
      
      # Verifica se a criaÃ§Ã£o foi bem-sucedida
      if [ $? -eq 0 ]; then
        echo "âœ… Rede $var4 criada com sucesso!"
        
        # Salva no settings.yaml
        save_macvlan_to_yaml "$var1" "$var2" "$var3" "$var4"
        
        dialog --title "Sucesso" --msgbox "Rede MACVLAN '$var4' criada e salva no settings.yaml!\n\nSubnet: $var1/24\nGateway: $var2\nInterface: $var3" 10 50
      else
        echo "âŒ Erro ao criar a rede $var4"
        dialog --title "ERRO" --msgbox "Falha ao criar a rede MACVLAN '$var4'!" 6 40
      fi
    else
      echo "A macvlan $var4 existe! Saindo..."
      dialog --title "ERRO" --msgbox "A rede MACVLAN '$var4' jÃ¡ existe!" 6 40
    fi
  fi
}

# FunÃ§Ã£o para salvar configuraÃ§Ãµes MACVLAN no system.yaml
function save_macvlan_to_yaml {
  local subnet="$1"
  local gateway="$2"
  local interface="$3"
  local network_name="$4"
  
  local yaml_file="/srv/system.yaml"
  local datetime=$(date +"%d/%m/%Y - %H:%M:%S")
  
  echo "ðŸ’¾ Salvando configuraÃ§Ãµes MACVLAN no system.yaml..."
  
  # Verifica se o arquivo existe, se nÃ£o, cria estrutura bÃ¡sica
  if [ ! -f "$yaml_file" ]; then
    echo "ðŸ“ Criando arquivo system.yaml..."
    sudo mkdir -p /srv
    sudo tee "$yaml_file" > /dev/null << EOF
# Arquivo de configuraÃ§Ãµes do servidor
# Criado automaticamente em $datetime

Informacoes:
  Data_Instalacao: "$datetime"
  Data_Restauracao: "Nunca foi reinstalado."

Hardware:
  Tipo: "Servidor"
  Placa: "Desconhecida"

Redes: {}
EOF
  fi
  
  # Verifica se jÃ¡ existe a seÃ§Ã£o Redes
  if ! grep -q "Redes:" "$yaml_file"; then
    echo "ðŸ“ Adicionando seÃ§Ã£o Redes ao system.yaml..."
    sudo yq -i '.Redes = {}' "$yaml_file"
  fi
  
  # Adiciona as configuraÃ§Ãµes da nova rede MACVLAN
  echo "ðŸ“ Salvando rede '$network_name' no system.yaml..."
  
  sudo yq -i "
    .Redes.\"$network_name\" = {
      \"subnet\": \"$subnet/24\",
      \"gateway\": \"$gateway\",
      \"interface\": \"$interface\",
      \"data_criacao\": \"$datetime\",
      \"status\": \"ativa\"
    }
  " "$yaml_file"
  
  echo "âœ… ConfiguraÃ§Ãµes salvas com sucesso!"
  
  # Mostra confirmaÃ§Ã£o das configuraÃ§Ãµes salvas
  echo ""
  echo "ðŸ“‹ CONFIGURAÃ‡Ã•ES SALVAS:"
  echo "   Nome da rede: $network_name"
  echo "   Subnet: $subnet/24"
  echo "   Gateway: $gateway" 
  echo "   Interface: $interface"
  echo "   Data: $datetime"
  echo ""
}

# FunÃ§Ã£o adicional para listar redes MACVLAN salvas
function list_saved_macvlans {
  local yaml_file="/srv/system.yaml"
  
  if [ ! -f "$yaml_file" ]; then
    echo "âŒ Arquivo system.yaml nÃ£o encontrado!"
    return 1
  fi
  
  echo "ðŸ“‹ REDES MACVLAN SALVAS NO SYSTEM.YAML:"
  echo "======================================="
  
  # Lista todas as redes MACVLAN salvas
  networks=$(yq -r '.Redes | keys[]' "$yaml_file" 2>/dev/null)
  
  if [ -z "$networks" ]; then
    echo "â„¹ï¸  Nenhuma rede MACVLAN encontrada no system.yaml"
    return
  fi
  
  echo ""
  for network in $networks; do
    subnet=$(yq -r ".Redes.\"$network\".subnet" "$yaml_file")
    gateway=$(yq -r ".Redes.\"$network\".gateway" "$yaml_file")
    interface=$(yq -r ".Redes.\"$network\".interface" "$yaml_file")
    data_criacao=$(yq -r ".Redes.\"$network\".data_criacao" "$yaml_file")
    status=$(yq -r ".Redes.\"$network\".status" "$yaml_file")
    
    echo "ðŸŒ Rede: $network"
    echo "   ðŸ“¡ Subnet: $subnet"
    echo "   ðŸšª Gateway: $gateway"
    echo "   ðŸ”Œ Interface: $interface"
    echo "   ðŸ“… Criada em: $data_criacao"
    echo "   ðŸ“Š Status: $status"
    
    # Verifica se a rede ainda existe no Docker
    docker_exists=$(docker network ls --format "{{.Name}}" | grep -x "$network" && echo "exists" || echo "not_found")
    if [ "$docker_exists" = "exists" ]; then
      echo "   ðŸ³ Docker: âœ… Rede existe"
    else
      echo "   ðŸ³ Docker: âŒ Rede nÃ£o encontrada"
    fi
    echo ""
  done
}

# FunÃ§Ã£o para remover rede MACVLAN e atualizar system.yaml
function remove_macvlan_and_update_yaml {
  local network_name="$1"
  local yaml_file="/srv/system.yaml"
  
  if [ -z "$network_name" ]; then
    echo "âŒ Nome da rede nÃ£o fornecido!"
    return 1
  fi
  
  echo "ðŸ—‘ï¸  Removendo rede MACVLAN '$network_name'..."
  
  # Remove a rede do Docker
  if docker network rm "$network_name" 2>/dev/null; then
    echo "âœ… Rede '$network_name' removida do Docker"
    
    # Atualiza o status no system.yaml ou remove completamente
    if [ -f "$yaml_file" ]; then
      # OpÃ§Ã£o 1: Marcar como removida (manter histÃ³rico)
      sudo yq -i ".Redes.\"$network_name\".status = \"removida\"" "$yaml_file" 2>/dev/null
      sudo yq -i ".Redes.\"$network_name\".data_remocao = \"$(date '+%d/%m/%Y - %H:%M:%S')\"" "$yaml_file" 2>/dev/null
      
      # OpÃ§Ã£o 2: Remover completamente (descomente a linha abaixo se preferir)
      # sudo yq -i "del(.Redes.\"$network_name\")" "$yaml_file" 2>/dev/null
      
      echo "âœ… ConfiguraÃ§Ãµes atualizadas no system.yaml"
    fi
  else
    echo "âŒ Erro ao remover a rede '$network_name' ou rede nÃ£o existe"
    return 1
  fi
}

# Exemplo de uso das novas funÃ§Ãµes:
# list_saved_macvlans
# remove_macvlan_and_update_yaml "macvlan"

function rmmacvland {
  local yaml_file="/srv/system.yaml"
  
  # Lista redes MACVLAN existentes no Docker
  existing_networks=($(docker network ls --filter driver=macvlan --format "{{.Name}}" | sort))
  
  if [ ${#existing_networks[@]} -eq 0 ]; then
    dialog --title "InformaÃ§Ã£o" --msgbox "Nenhuma rede MACVLAN encontrada no Docker!" 6 50
    return
  fi
  
  # Mostra lista de redes para escolher
  echo "ðŸ“‹ REDES MACVLAN DISPONÃVEIS PARA REMOÃ‡ÃƒO:"
  echo "=========================================="
  echo ""
  
  for i in "${!existing_networks[@]}"; do
    network="${existing_networks[$i]}"
    
    # Pega informaÃ§Ãµes da rede do Docker
    subnet=$(docker network inspect "$network" --format '{{range .IPAM.Config}}{{.Subnet}}{{end}}' 2>/dev/null || echo "N/A")
    gateway=$(docker network inspect "$network" --format '{{range .IPAM.Config}}{{.Gateway}}{{end}}' 2>/dev/null || echo "N/A")
    
    # Verifica se existe no system.yaml
    yaml_status="â“ NÃ£o registrada"
    if [ -f "$yaml_file" ]; then
      yaml_exists=$(yq -r ".Redes.\"$network\"" "$yaml_file" 2>/dev/null)
      if [ "$yaml_exists" != "null" ]; then
        yaml_status="ðŸ“‹ Registrada no YAML"
      fi
    fi
    
    echo "$((i+1))) $network"
    echo "   ðŸ“¡ Subnet: $subnet"
    echo "   ðŸšª Gateway: $gateway"
    echo "   ðŸ“„ Status: $yaml_status"
    echo ""
  done
  
  # Dialog para escolher qual remover
  menu_options=()
  for i in "${!existing_networks[@]}"; do
    network="${existing_networks[$i]}"
    subnet=$(docker network inspect "$network" --format '{{range .IPAM.Config}}{{.Subnet}}{{end}}' 2>/dev/null || echo "N/A")
    menu_options+=("$((i+1))" "$network ($subnet)")
  done
  
  # Adiciona opÃ§Ã£o manual
  menu_options+=("0" "Digitar nome manualmente")
  
  if ! choice=$(dialog --title "Remover Rede MACVLAN" --backtitle "Docker Tools" --menu "Escolha a rede para remover:" 0 0 0 "${menu_options[@]}" 2>&1 > /dev/tty); then
    return
  fi
  
  # Determina qual rede remover
  local network_to_remove=""
  
  if [ "$choice" = "0" ]; then
    # OpÃ§Ã£o manual
    if ! network_to_remove=$(dialog --title "Nome da Rede" --backtitle "Docker Tools" --inputbox "Digite o nome da rede MACVLAN para remover:" 8 50 2>&1 > /dev/tty); then
      return
    fi
    
    if [ -z "$network_to_remove" ]; then
      dialog --title "ERRO" --msgbox "Nome da rede nÃ£o pode estar vazio!" 6 40
      return
    fi
  else
    # Rede selecionada da lista
    network_to_remove="${existing_networks[$((choice-1))]}"
  fi
  
  # Verifica se a rede existe
  if ! docker network inspect "$network_to_remove" >/dev/null 2>&1; then
    dialog --title "ERRO" --msgbox "A rede '$network_to_remove' nÃ£o existe no Docker!" 6 50
    return
  fi
  
  # Mostra informaÃ§Ãµes da rede antes de remover
  subnet=$(docker network inspect "$network_to_remove" --format '{{range .IPAM.Config}}{{.Subnet}}{{end}}' 2>/dev/null || echo "N/A")
  gateway=$(docker network inspect "$network_to_remove" --format '{{range .IPAM.Config}}{{.Gateway}}{{end}}' 2>/dev/null || echo "N/A")
  
  # Verificar se tem containers conectados
  connected_containers=$(docker network inspect "$network_to_remove" --format '{{range .Containers}}{{.Name}} {{end}}' 2>/dev/null)
  
  warning_msg="ATENÃ‡ÃƒO: VocÃª estÃ¡ prestes a remover a rede:\n\n"
  warning_msg+="ðŸŒ Nome: $network_to_remove\n"
  warning_msg+="ðŸ“¡ Subnet: $subnet\n"
  warning_msg+="ðŸšª Gateway: $gateway\n\n"
  
  if [ -n "$connected_containers" ]; then
    warning_msg+="âš ï¸  CONTAINERS CONECTADOS:\n$connected_containers\n\n"
    warning_msg+="Os containers serÃ£o desconectados da rede!\n\n"
  fi
  
  warning_msg+="Esta aÃ§Ã£o Ã© IRREVERSÃVEL!\n\nDeseja continuar?"
  
  # ConfirmaÃ§Ã£o final
  if ! dialog --title "CONFIRMAÃ‡ÃƒO" --backtitle "RemoÃ§Ã£o de Rede MACVLAN" --yesno "$warning_msg" 0 0; then
    dialog --title "Cancelado" --msgbox "RemoÃ§Ã£o cancelada pelo usuÃ¡rio." 6 40
    return
  fi
  
  # Executar remoÃ§Ã£o
  echo "ðŸ—‘ï¸  Removendo rede MACVLAN '$network_to_remove'..."
  
  # Remove a rede do Docker
  if docker network rm "$network_to_remove" 2>/dev/null; then
    echo "âœ… Rede '$network_to_remove' removida do Docker com sucesso!"
    
    # Atualiza o system.yaml se a rede estiver registrada
    if [ -f "$yaml_file" ]; then
      yaml_exists=$(yq -r ".Redes.\"$network_to_remove\"" "$yaml_file" 2>/dev/null)
      if [ "$yaml_exists" != "null" ]; then
        echo "ðŸ“ Atualizando system.yaml..."
        
        # OpÃ§Ã£o 1: Marcar como removida (manter histÃ³rico)
        sudo yq -i ".Redes.\"$network_to_remove\".status = \"removida\"" "$yaml_file" 2>/dev/null
        sudo yq -i ".Redes.\"$network_to_remove\".data_remocao = \"$(date '+%d/%m/%Y - %H:%M:%S')\"" "$yaml_file" 2>/dev/null
        
        # OpÃ§Ã£o 2: Remover completamente do YAML (descomente se preferir)
        # sudo yq -i "del(.Redes.\"$network_to_remove\")" "$yaml_file" 2>/dev/null
        
        echo "âœ… system.yaml atualizado com sucesso!"
        
        dialog --title "Sucesso" --msgbox "Rede '$network_to_remove' removida com sucesso!\n\nâœ… Docker: Rede removida\nâœ… YAML: Status atualizado" 10 50
      else
        dialog --title "Sucesso" --msgbox "Rede '$network_to_remove' removida do Docker!\n\n(NÃ£o estava registrada no system.yaml)" 8 50
      fi
    else
      dialog --title "Sucesso" --msgbox "Rede '$network_to_remove' removida do Docker!\n\n(Arquivo system.yaml nÃ£o encontrado)" 8 50
    fi
    
  else
    dialog --title "ERRO" --msgbox "Erro ao remover a rede '$network_to_remove'!\n\nVerifique se nÃ£o hÃ¡ containers conectados." 8 50
    return 1
  fi
}

# FunÃ§Ã£o auxiliar para listar informaÃ§Ãµes detalhadas das redes (opcional)
function show_macvlan_details {
  local yaml_file="/srv/system.yaml"
  
  echo "ðŸ“‹ DETALHES DAS REDES MACVLAN:"
  echo "=============================="
  echo ""
  
  # Redes no Docker
  docker_networks=($(docker network ls --filter driver=macvlan --format "{{.Name}}" | sort))
  
  if [ ${#docker_networks[@]} -gt 0 ]; then
    echo "ðŸ³ REDES NO DOCKER:"
    for network in "${docker_networks[@]}"; do
      subnet=$(docker network inspect "$network" --format '{{range .IPAM.Config}}{{.Subnet}}{{end}}' 2>/dev/null || echo "N/A")
      gateway=$(docker network inspect "$network" --format '{{range .IPAM.Config}}{{.Gateway}}{{end}}' 2>/dev/null || echo "N/A")
      echo "   ðŸŒ $network - $subnet (GW: $gateway)"
    done
    echo ""
  fi
  
  # Redes no YAML
  if [ -f "$yaml_file" ]; then
    yaml_networks=$(yq -r '.Redes | keys[]' "$yaml_file" 2>/dev/null)
    if [ -n "$yaml_networks" ]; then
      echo "ðŸ“„ REDES NO SYSTEM.YAML:"
      for network in $yaml_networks; do
        status=$(yq -r ".Redes.\"$network\".status" "$yaml_file")
        subnet=$(yq -r ".Redes.\"$network\".subnet" "$yaml_file")
        echo "   ðŸ“‹ $network - $subnet (Status: $status)"
      done
    fi
  fi
}

function dialognet {
  dialog --title "InformaÃ§Ã£o" --msgbox "Checar a existencia de altnames nas informacoes a seguir!" 7 40
  dialog --title "InformaÃ§Ã£o" --msgbox "$(ip a)" 25 70
}

tools

exit 1
